{
  "animatorMap": {
    "COMMENT": "Animation Graph for the Digit Copy Tutor",

    "digit_copy": {

      "type": "ANIMATOR",
      "title": "Digit copying tutor",
      "COMMENT": "This tutor is designed for copying single digit numbers 0-9.",
      "version": "1.0.0",
      "rootnode": "INTRO_STATE",

      "nodeMap": {

        "COMMENT": "@@@@@  CNodes  @@@@@",

        "INTRO_STATE": {
          "type": "NODE",
          "COMMENT": "Intro Clip",
          "maptype":"moduleMap",
          "mapname": "PLAYINTRO",
          "preenter":["SET_VERSION","SET_DATASOURCE","FW_SET_REC","FW_DISABLE"],
          //temp ---- "preenter":["GB_DISABLE","FW_DISABLE"],
          "preexit" :[],
          "edges": [
            {
              "constraint": "",
              "edge": "NEWCHAR"
            }
          ]
        },

        "NEWCHAR":{
          "COMMENT":"This node presents a digit for user to copy.",
          "type":"node",
          "preenter":["GETCHAR"],
          "maptype":"moduleMap",
          "mapname": "PLAYCHAR",
          "preexit" :[],
          "edges":
          [
            {"constraint":"","edge":"USERINPUT"}
          ]
        },

        "USERINPUT":{
          "COMMENT":"When module is complete - move to next scene in the scenegraph",
          "type":"node",
          "maptype":"moduleMap",
          "mapname": "FINGERWRITING",
          "preenter":["FW_ENABLE","REMINDER_TIMER"],
          "preexit" :["FW_DISABLE"],
          "edges":
          [
            {"constraint":"FTR_RIGHT","edge":"CORRECT"},
            {"constraint":"FTR_WRONG","edge":"WRONG"},
            //{"constraint":"","edge":"UNRECOGNIZED"}
	        {"constraint":"","edge":"UNRECOGNIZED"}
            //{"constraint":"","edge":"HESITATION"}
          ]
        },

        "CORRECT":{
          "COMMENT":"When user inputs a correct answer...",
          "type":"node",
          "maptype":"moduleMap",
          "mapname": "PLAYCORRECT",
          "preenter":[],
          "preexit" :["REMOVERESPONSE","REMOVESTIMULUS"],
          "edges":
          [
            {"constraint":"COND_PASS1","edge":"EXITCLIP1"},
            {"constraint":"COND_PASS2","edge":"EXITCLIP2"},
            {"constraint":"","edge":"NEWCHAR"}
          ]
        },

        "WRONG":{
          "COMMENT":"When user inputs an incorrect answer...",
          "type":"node",
          "maptype":"moduleMap",
          "mapname": "PLAYWRONG",
          "preenter":[],
          "preexit" :["REMOVERESPONSE"],
          "edges":
          [

            {"constraint":"","edge":"USERINPUT"}
          ]
        },

        "UNRECOGNIZED":{
          "COMMENT":"When the recognizer fails to identify the input...",
          "type":"node",
          "maptype":"moduleMap",
          "mapname": "PLAYUNRECOGNIZED",
          "preenter":[],
          "preexit" :["REMOVERESPONSE"],
          "edges":
          [
            {"constraint":"","edge":"USERINPUT"}
          ]
        },

//        "HESITATION":{
//          "COMMENT":"When the user doesn't write anything...",
//          "type":"node",
//          "maptype":"moduleMap",
//          "mapname": "PLAYHESITATION",
//          "preenter":[],
//          "preexit" :[],
//          "edges":
//          [
//            {"constraint":"","edge":"USERINPUT"}
//          ]
//        },

        "EXITCLIP1": {
          "COMMENT":"Exit Clip for ALL_CORRECT",
          "type":"node",
          "maptype":"moduleMap",
          "mapname": "PLAYEXIT1",
          "preenter":[],
          "preexit" :[],
          "edges":
          [
            {"constraint":"","edge":"NEXTSCENE"}
          ]
        },

        "EXITCLIP2": {"COMMENT":"Exit Clip for NOT_ALL_CORRECT",
          "type":"node",
          "maptype":"moduleMap",
          "mapname": "PLAYEXIT2",
          "preenter":[],
          "preexit" :[],
          "edges":
          [
            {"constraint":"","edge":"NEXTSCENE"}
          ]
        },

        "NEXTSCENE": {
          "type": "NODE",
          "COMMENT": "When module is complete - move to next scene in the scenegraph",
          "maptype":"actionMap",
          "mapname":"GOTONEXTSCENE",
          "preenter": [],
          "preexit": [],
          "edges": [
          ]
        }
      },

      "moduleMap": {

        "COMMENT": "@@@@@  CModules  @@@@@",

        "PLAYINTRO":{
          "type": "MODULE",
          "reuse":true,
          "COMMENT": "TBD",
          "tracks": [
            {"type": "AUDIO", "command": "PLAY", "soundsource": "Now lets practice writing some numbers.mp3", "mode":"flow", "features": ""}
          ]
        },

        "PLAYCHAR": {
          "type": "MODULE",
          "reuse":true,
          "COMMENT": "TBD",
          "tracks": [
            {"type": "COMMAND", "id": "Sstimulus", "method": "show", "parms": "TRUE:Boolean","features":""},
            {"type": "COMMAND", "id": "Sstimulus", "method": "zoomInOut", "parms": "2.0:Float:1000:Long","features":""},
            //{"type": "AUDIO", "command": "PLAY", "soundsource": "This is the number.mp3", "mode":"flow", "features": ""},
            {"type": "AUDIO", "command": "PLAY", "soundsource": "{{Sstimulus.value}}.mp3",   "mode":"flow", "features": ""} //the stimulus digit
            //{"type": "AUDIO", "command": "PLAY", "soundsource": "Please write the number.mp3", "mode":"flow", "features": ""},
            //{"type": "AUDIO","command": "PLAY", "soundsource": "with your finger.mp3", "mode":"flow", "features": ""}
          ]
        },

        "FINGERWRITING":{
          "type":"MODULE",
          "reuse":true,
          "COMMENT": "FingerWriting Module",
          "tracks": [
            {"type": "COMMAND", "id": "SfingerWriter", "method": "onStartWriting", "parms": "CANCEL_REMINDER:String"},
            // This would call the cancel reminder action below when the user starts writing
            {"type": "COMMAND", "id": "Sresponse", "method": "onRecognitionComplete", "parms": "NEXT:String"},
            // This would increment the animation_graph when it is in a wait state.  e.g if it is sitting at the end of a stream audio clip
            {"type": "COMMAND", "cmd": "WAIT" }
            //{"type": "COMMAND", "id": "Sresponse", "method": "show", "parms": "TRUE:Boolean","features":""}
          ]
        },

        "PLAYCORRECT":{
          "type": "MODULE",
          "reuse":true,
          "COMMENT": "TBD",
          "tracks": [
            {"type": "COMMAND", "id": "Sresponse", "method": "setForeGround", "parms": "normal:String","features":""}, //set the correct string in normal color
            {"type": "AUDIO", "command": "PLAY", "soundsource": "Good.mp3","mode":"flow", "features": ""}
          ]
        },

        "PLAYWRONG": {
          "type": "MODULE",
          "reuse":true,
          "COMMENT": "TBD",
          "tracks": [
            {"type": "COMMAND", "id": "Sresponse", "method": "setForeGround", "parms": "wrong:String","features":""}, //flag the incorrect string in red color
            {"type": "AUDIO", "command": "PLAY", "soundsource": "That looks like.mp3", "mode":"flow","features": ""},
            {"type": "AUDIO", "command": "PLAY", "soundsource": "{{Sresponse.value}}.mp3","mode":"flow", "features": ""},  // the recognizer output
            {"type": "AUDIO", "command": "PLAY", "soundsource": "Try again.mp3","mode":"flow", "features": ""}
          ]
        },

        "PLAYUNRECOGNIZED": {
          "type": "MODULE",
          "reuse":true,
          "COMMENT": "TBD",
          "tracks": [
            {"type": "COMMAND", "id": "Sresponse", "method": "setForeGround", "parms": "wrong:String","features":""}, //flag the incorrect string in red color
            {"type": "AUDIO", "command": "PLAY", "soundsource": "Huh.mp3", "mode":"flow","features": ""},
            {"type": "AUDIO", "command": "PLAY", "soundsource": "That doesnt look like.mp3", "mode":"flow","features": ""},
            {"type": "AUDIO", "command": "PLAY", "soundsource": "{{Sstimulus.value}}.mp3","mode":"flow", "features": ""}, //the stimulus digit
            {"type": "AUDIO", "command": "PLAY", "soundsource": "Try again.mp3","mode":"flow", "features": ""}
          ]
        },

//        "PLAYHESITATION":{
//          "type": "MODULE",
//          "reuse":true,
//          "COMMENT": "TBD",
//          "tracks": [
//            {"type": "AUDIO", "command": "PLAY", "soundsource": "Please write the number.mp3", "mode":"event", "features": ""},
//            {"type": "AUDIO", "command": "PLAY", "soundsource": "{{Sstimulus.value}}.mp3",   "mode":"event", "features": ""} //the stimulus digit
//          ]
//        },

        "PLAYEXIT1":{
          "type": "MODULE",
          "reuse":true,
          "COMMENT": "TBD",
          "tracks": [
            {"type": "AUDIO", "command": "PLAY", "soundsource": "You did a good job.mp3", "mode":"flow", "features": ""}
            //{"type": "AUDIO", "command": "PLAY", "soundsource": "You wrote all of them correctly.mp3",   "mode":"flow", "features": ""}
          ]
        },

        "PLAYEXIT2":{
          "type": "MODULE",
          "reuse":true,
          "COMMENT": "TBD",
          "tracks": [
            {"type": "AUDIO", "command": "PLAY", "soundsource": "You did a good job.mp3", "mode":"flow", "features": ""}
            //{"type": "AUDIO", "command": "PLAY", "soundsource": "Next time you can do better.mp3",   "mode":"flow", "features": ""}
          ]
        }

//        "PLAYCORRECT": {
//          "type": "MODULE",
//          "reuse":true,
//          "COMMENT": "TBD",
//          "tracks": [
//            {"type": "AUDIO", "command": "PLAY", "soundsource": "good.mp3", "features": ""}
//          ]
//        }
//
      },

      "actionMap": {

        "my_action": {"type": "TIMER", "name": "hint_timeout", "duration":"20", "repeat":"false", "action":"START", "ontimer":"ACTION_NAME", "features": "" },

        "COMMENT": "@@@@@  CActions @@@@@ ",

        "SET_VERSION":{"type": "COMMAND", "id": "Sbanner", "method": "setVersionID", "parms": "v.0.0.1:String","features":""},

        "SET_DATASOURCE":{"type": "COMMAND", "id": "Sstimulus", "method": "setDataSource", "parms": "[0,1,2,3,4,5,6,7,8,9]:String","features":"!DATA_SSTIMULUS"},

        "FW_SET_REC":{"type": "COMMAND", "id": "SfingerWriter", "method": "setRecognizer", "parms": "EN_STD_NUM:String","features":""},

        "REMINDER_TIMER": {"type": "TIMER", "id":"ReminderTimer", "startdelay":"0", "period":"6000", "repeat":"false", "action":"CREATEANDSTART", "ontimer":"HESITATION_TRACK", "features": "" },
        //set the waiting time limit as 10 seconds

        "CANCEL_REMINDER": {"type": "TIMER", "id":"ReminderTimer", "action":"CANCEL", "features": "" },

        "HESITATION_TRACK": {"type": "TIMELINE", "trackname": "HES_ABS", "features": ""},

        "GB_DISABLE":{"type": "COMMAND", "id": "SgoButton", "method": "enable", "parms": "FALSE:Boolean","features":""},
        //disable Go button
        "GB_ENABLE":{"type": "COMMAND", "id": "SgoButton", "method": "enable", "parms": "TRUE:Boolean","features":""},
        //enable Go button

        "FW_DISABLE":{"type": "COMMAND", "id": "SfingerWriter", "method": "enable", "parms": "FALSE:Boolean","features":""},
        //disable FingerWriting
        "FW_ENABLE":{"type": "COMMAND", "id": "SfingerWriter", "method": "enable", "parms": "TRUE:Boolean","features":""},
        //enable FingerWriting

        "GETCHAR":{"type": "COMMAND", "id": "Sstimulus", "method": "next" ,"features":""},
        //get a new digit from the list.

        //"GETRESPONSE":{"type": "COMMAND", "id": "Sresponse", "method": "???" ,"features":""},
        //get the recognized character from the recognizer???

        "SHOWRESPONSE":{"type": "COMMAND", "id": "Sresponse", "method": "show", "parms": "TRUE:Boolean","features":""},
        "REMOVERESPONSE":{"type": "COMMAND", "id": "Sresponse", "method": "clear", "features":""},
        //remove the preview string

        "SHOWSTIMULUS":{"type": "COMMAND", "id": "Sstimulus", "method": "show", "parms": "TRUE:Boolean","features":""},
        "REMOVESTIMULUS":{"type": "COMMAND", "id": "Sstimulus", "method": "show", "parms": "FALSE:Boolean","features":""},
        //remove the stimulus

        "GOTONEXTSCENE": {"type": "COMMAND", "cmd": "gotoNextScene"},
        "NEXT": {"type": "COMMAND", "cmd": "NEXT"  }
      },

      "constraintMap": {

        "COMMENT": "@@@@@  CConstraints @@@@@ ",

        "COND_PASS1": {
          "type": "CONDITION",
          "If": "FTR_NOWORDS && ALL_CORRECT",
          "Then":"true",
          "Else":"false"
        },

        "COND_PASS2": {
          "type": "CONDITION",
          "If": "FTR_NOWORDS && NOT_ALL_CORRECT",
          "Then":"true",
          "Else":"false"
        },

        "FTR_NOWORDS":{
          "type": "CONDITION",
          "test":"FTR_NOWORDS"
        },

        "FTR_WORDS":{
          "type": "CONDITION",
          "test":"!FTR_NOWORDS"
        },

        "ALL_CORRECT":{
          "type": "CONDITION",
          "test":"ALL_CORRECT"
        },

        "NOT_ALL_CORRECT":{
          "type": "CONDITION",
          "test":"!ALL_CORRECT"
        },

        "FTR_RIGHT":{
          "type": "CONDITION",
          "test":"FTR_RIGHT"
        },

        "FTR_WRONG":{
          "type": "CONDITION",
          "test":"FTR_WRONG"
        },

        "FTR_UNRECOGNIZED":{
          "type": "CONDITION",
          "test":"FTR_UNRECOGNIZED"
        }
      }
    }
  }
}
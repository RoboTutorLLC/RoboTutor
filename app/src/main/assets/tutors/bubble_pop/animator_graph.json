{
  "animatorMap": {
    "COMMENT": "Animation Graph for the BubblePop Game",

    "bubble_pop": {

      "type": "ANIMATOR",
      "title": "BubblePop Game",
      "COMMENT": "This is where you describe your tutor",
      "version": "1.0.0",
      "rootnode": "INTRO_STATE",

      "nodeMap": {

        "COMMENT": "@@@@@  CNodes  @@@@@",

        "INTRO_STATE": {
          "type": "NODE",
          "COMMENT": "Intro Clip - we only ever visit this node once",
          "maptype":"actionMap",
          "mapname": "NEXTNODE",
          "preenter": ["SET_VERSION","PLAY_BACKINGTRACK","PLAY_PROMPT","SET_DATASOURCE","NEXT_DATASET"],
          "preexit": [
          ],
          "edges": [
            {
              "constraint": "",
              "edge": "USERINPUT"
            }
          ]
        },

        "UPDATE_STIMULUS": {
          "type": "NODE",
          "COMMENT": "We may say or show the stimulus at this point",
          "maptype":"moduleMap",
          "mapname": "UPDATESTIMULUS",
          "preenter": [],
          "preexit": [],
          "edges": [
            {
              "constraint": "",
              "edge": "USERINPUT"
            }
          ]
        },


        "USER_INPUT": {
          "type": "NODE",
          "COMMENT": "When module is complete - move to next scene in the scenegraph",
          "maptype":"actionMap",
          "mapname": "USERINPUT",
          "preenter": [],
          "preexit": [
          ],
          "edges": [
            {
              "constraint":"FTR_RIGHT",
              "edge": "PLAYCORRECT"
            },
            {
              "constraint": "",
              "edge": "PLAYWRONG"
            }
          ]
        },

        "PLAT_CORRECT": {
          "type": "NODE",
          "COMMENT": "When module is complete - move to next scene in the scenegraph",
          "maptype":"moduleMap",
          "mapname": "PLAYCORRECT",
          "preenter": [],
          "preexit": [
            "GETWORD"
          ],
          "edges": [
            {
              "constraint": "FTR_NOWORDS",
              "edge": "NEXT_SCENE"
            },
            {
              "constraint": "",
              "edge": "USERINPUT"
            }
          ]
        },

        "PLAY_WRONG": {
          "type": "NODE",
          "COMMENT": "When module is complete - move to next scene in the scenegraph",
          "maptype":"moduleMap",
          "mapname": "PLAYWRONG",
          "preenter": [],
          "preexit": [
            "GETWORD"
          ],
          "edges": [
            {
              "constraint": "FTR_NOWORDS",
              "edge": "NEXT_SCENE"
            },
            {
              "constraint": "",
              "edge": "INTRO_STATE"
            }
          ]
        },
        "NEXT_SCENE": {
          "type": "NODE",
          "COMMENT": "When module is complete - move to next scene in the scenegraph",
          "maptype":"actionMap",
          "mapname": "NEXTSCENE",
          "preenter": [],
          "preexit": [],
          "edges": [
          ]
        }
      },

      "moduleMap": {

        "COMMENT": "@@@@@  CModules  @@@@@",

        // Here we manage the Stimulus display.
        // We are either going to Speak the Stimulus / Show the Stimulus / Both or Neither -

        "UPDATESTIMULUS": {
          "type": "MODULE",
          "reuse":true,
          "tracks": [
            {"type": "AUDIO", "command": "PLAY", "soundsource": "{{SBubblePop.stimulus}}.mp3",  "soundpackage":"default", "mode":"flow", "features": "FTR_SAY"},

            // If we are showing it we have to wait for the animation to complete before continuing
            {"type": "COMMAND", "id": "SBubblePop", "method": "setVolatileBehavior", "parms": "STIMULUS_SHOWN:String,NEXT:String" ,"features":"FTR_SHOW"},
            {"type": "COMMAND", "id": "SBubblePop", "method": "postEvent",           "parms": "SHOW_STIMULUS:String"               ,"features":"FTR_SHOW"},

            // Otherwise we just continue to the next node
            {"type": "COMMAND", "cmd": "NEXT", "feature":"!FTR_SHOW"  }
          ]
        },


        "PLAYCORRECT": {
          "type": "MODULE",
          "reuse":true,
          "COMMENT": "????",
          "tracks": [
            {"type": "AUDIO", "command": "PLAY", "soundsource": "popSound.mp3",  "soundpackage":"tutor_effect", "mode":"flow", "features": ""},

            {"type": "COMMAND", "id": "SBubblePop", "method": "postEvent", "parms": "POP_BUBBLE:String" ,"features":""}
          ]
        },


        "PLAYWRONG": {
          "type": "MODULE",
          "reuse":true,
          "COMMENT": "????",
          "tracks": [
            {"type": "AUDIO", "command": "PLAY", "soundsource": "wrong.mp3", "soundpackage":"tutor_effect", "mode":"flow", "features": ""},

            {"type": "COMMAND", "id": "SBubblePop", "method": "postEvent", "parms": "WIGGLE_BUBBLE:String" ,"features":""}
          ]
        }
      },

      "actionMap": {

        "COMMENT": "@@@@@  CActions @@@@@ ",

        "PLAY_BACKINGTRACK": {"type": "AUDIO", "command": "PLAY", "soundsource": "gamesound.mp3", "soundpackage":"tutor_effect", "repeat":true, "volume": 0.20, "mode":"flow", "features": ""},
        "PLAY_PROMPT": {"type": "AUDIO", "command": "PLAY", "soundsource": "Please tap on it.mp3", "soundpackage":"default", "volume": 0.7, "mode":"flow", "features": ""},

        "SET_VERSION":{"type": "COMMAND", "id": "Sbanner", "method": "setVersionID", "parms": "v.0.0.1:String","features":""},
        "SET_DATASOURCE":{"type": "COMMAND", "id": "SBubblePop", "method": "setDataSource", "parms": "[file]bp_data.json:String","features":"!DATA_SBUBBLEPOP"},
        "NEXT_DATASET":{"type": "COMMAND", "id": "SBubblePop", "method": "next" ,"features":""},



//        "SET_SHOW":{"type": "COMMAND", "id": "SBubblePop", "method": "setEventBehavior" ,"features":""},

        "NEXTNODE": {"type": "COMMAND", "cmd": "NEXT"  },
        "USERINPUT":  {"type": "COMMAND", "cmd": "WAIT"  },


        "B5_ATTACH": {
          "type": "COMMAND", "id": "button5", "method": "setButtonBehavior", "parms": "STOP:String"
        },
        "B5_DEATTACH": {
          "type": "COMMAND", "id": "button5", "method": "setButtonBehavior", "parms": "NULL:String"
        },


        "NEXTSCENE": {
          "type": "COMMAND", "cmd": "gotoNextScene"
        }
      },

      "constraintMap": {

        "COMMENT": "@@@@@  CConstraints @@@@@ ",

        "FTR_NOWORDS": {
          "type": "CONDITION",
          "cmd": "test",
          "code": "FTR_NOWORDS"
        },
        "FTR_WORDS": {
          "type": "CONDITION",
          "cmd": "test",
          "code": "!FTR_NOWORDS"
        },
        "FTR_RIGHT": {
          "type": "CONDITION",
          "cmd": "test",
          "code": "FTR_RIGHT"
        },
        "FTR_WRONG": {
          "type": "CONDITION",
          "cmd": "test",
          "code": "!FTR_RIGHT"
        }
      }
    }
  }
}